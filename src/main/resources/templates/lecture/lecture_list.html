<!DOCTYPE html>
<html layout:decorate="~{utils/layout}">
<head>
    <meta id="_csrf" name="_csrf" th:content="${_csrf.token}"/>
    <meta id="_csrf_header" name="_csrf_header" th:content="${_csrf.headerName}"/>
    <meta charset="UTF-8">
    <title>ProfPilot✈️: Lecture list</title>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <style>
        /* 모달 스타일 */
        .modal {
            display: none; /* 모달 초기에는 숨김 */
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4); /* 배경 어둡게 */
        }
    
        /* 모달 콘텐츠 스타일 */
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }
    
        /* 닫기 버튼 스타일 */
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
    
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
    
    <script>
        // 모달을 열고 닫는 함수
        function openModal() {
            document.getElementById('lecture-popup').style.display = 'block';
        }
    
        function closeModal() {
            document.getElementById('lecture-popup').style.display = 'none';
        }
    
        // 모달 외부 클릭 시 닫기
        window.onclick = function(event) {
            var modal = document.getElementById('lecture-popup');
            if (event.target == modal) {
                closeModal();
            }
        }
    </script>
    
</head>
<body>
    <div layout:fragment="content" class="container my-3">
        <table class="table">
            <thead class="table-dark">
            <tr class="text-center">
                <th style="width:5%">번호</th>
                <th style="width:20%">강의명</th>
                <th style="width:5%">강의실</th>
                <th style="width:10%">수업요일</th>
                <th style="width:10%">수업시작</th>
                <th style="width:10%">수업종료</th>
                <th style="width:10%">교수</th>
            </tr>
            </thead>
            <tbody>
            <tr class="text-center" th:each="lecture, loop : ${lectureList}">
                <div class="lecture_board">
                    <td th:text="${loop.index + 1}"></td>
                    <td><a th:href="@{/lecture/enter(name=${lecture.name})}" th:text="${lecture.name}"></a></td>
                    <td th:text="${lecture.Room}"></td>
                    <td th:text="${lecture.LectureDay}"></td>
                    <td th:text="${lecture.startTime}"></td>
                    <td th:text="${lecture.endTime}"></td>
                    <td th:text="${lecture.professor.getName()}"></td>
                </div>
            </tr>
            </tbody>
        </table>
        <div class="search-lecture">
            <h3 class="search-lecture-header">강의 검색</h3>
            <input type="text" id="search-lecture-input" class="form-control" placeholder="강의명 혹은 교수명을 입력하세요">
            <button id="listBtn" class="btn btn-primary">검색</button>
        </div>
        <div class="create-class" th:if="${userRole == 'student'}">
            <a th:href="@{/lecture/create}">
                <button class="btn btn-primary">create Lecture</button>
            </a>
        </div>
        <div id="lecture-popup" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span> <!-- 닫기 버튼 -->
                <div id="lecture-info"></div>
            </div>
        </div>
        
    <script type="text/javascript">
        $(function() {
            $("#listBtn").click(function() {
                $.ajax({
                    url: "/lecture/list/search/" + $("#search-lecture-input").val(),
                    type: "GET",
                    success: function(data) {
                        console.log(data);

                        // 검색 결과가 있을 경우에만 팝업을 생성하여 정보 표시
                        if (data.length > 0) {
                            // 데이터 표시 부분 수정
                            // 팝업을 담을 변수 초기화
                            var popupContent = '';

                            // 각 검색 결과에 대해 팝업 정보 구성
                            for (var i = 0; i < data.length; i++) {

                                // 현재 강의 정보 구성
                                var lectureName = "Name: " + data[i].name;
                                var professorName = "Professor: " + data[i].professor.name;
                                var room = "Room: " + data[i].room;
                                var day = "Day: " + data[i].lectureDay;
                                var startTime = "Start Time: " + data[i].startTime;
                                var endTime = "End Time: " + data[i].endTime;

                                // 팝업 내용에 현재 강의 정보 추가
                                popupContent += '<div class="lecture-popup">';
                                popupContent += '<h2>Lecture Details</h2>';
                                popupContent += '<p id="search-lecture-name">' + lectureName + '</p>';
                                popupContent += '<p id="search-lecture-professor">' + professorName + '</p>';
                                popupContent += '<p id="search-lecture-room">' + room + '</p>';
                                popupContent += '<p id="search-lecture-day">' + day + '</p>';
                                popupContent += '<p id="search-lecture-startTime">' + startTime + '</p>';
                                popupContent += '<p id="search-lecture-endTime">' + endTime + '</p>';
                                popupContent += '</div>';
                            }

                            // 팝업 내용을 모달에 삽입하고 모달 열기
                            document.getElementById('lecture-info').innerHTML = popupContent;
                            openModal(); // 모달 열기 함수 호출
                            // window.open("lecture_searched.html", "popup", "width=400, height=400, scrollbars=no");
                        } else {
                            // 검색 결과가 없을 경우에 대한 처리
                            alert("No lectures found.");
                        }
                    }
            });
        })
    });

    </script>
    </div>
</body>
</html>